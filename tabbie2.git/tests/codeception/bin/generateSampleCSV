#!/usr/bin/env php
<?php
// require the Faker autoloader
require_once '../../../vendor/fzaninotto/faker/src/autoload.php';

if (count($_SERVER['argv']) == 4) {
    $amount_venues = $_SERVER['argv'][1];
    $amount_teams = $_SERVER['argv'][2];
    $amount_adj = $_SERVER['argv'][3];
} else
if (count($_SERVER['argv']) == 2) {
    if ($_SERVER['argv'][1] % 4 != 0) {
        echo "Not divided by 4\n";
        exit();
    }
    $amount_teams = $_SERVER['argv'][1];
    $amount_venues = $amount_teams / 4;
    $amount_adj = $amount_venues * 3;
} else {
    echo ("Wrong Parameter! Possible Compination:\n");
    echo ($_SERVER['argv'][0] . " <Amount_Teams>\n");
    echo ($_SERVER['argv'][0] . " <Amount_Venues> <Amount_Teams> <Amount_Adjudicators>\n");
    exit();
}

echo "Run with:\n";
echo "Venues:\t" . $amount_venues . "\n";
echo "Teams:\t" . $amount_teams . "\n";
echo "Judges:\t" . $amount_adj . "\n";

// use the factory to create a Faker\Generator instance
$faker = Faker\Factory::create();

$output_venue = "Name;Active\n";
$output_teams = "Team Name;Society Name;A.Givenname;A.Surename;A.Email;B.Givenname;B.Surename;B.Email\n";
$output_adjudicator = "Society;Givenname;Surename;Email;Strength\n";
$save = [];

echo "\n== Venues ==\n";
for ($v = 0; $v < $amount_venues; $v++) {
    $line = "Room " . ($v + 1) . ";1\n";
    //echo $line;
    $output_venue .= $line;
}

echo "\n== Teams ==\n";
for ($t = 0; $t < $amount_teams; $t++) {
    $city = $faker->city;
    $save[] = $city;
    $line = $city . " " . strtoupper($faker->randomLetter) . ";" .
            $city . " Debating Society;" .
            addslashes($faker->firstName) . ";" .
            addslashes($faker->lastName) . ";" .
            $faker->email . ";" .
            addslashes($faker->firstName) . ";" .
            addslashes($faker->lastName) . ";" .
            $faker->email . "\n";
    //echo $line;
    $output_teams .= $line;
}

echo "\n== Judges ==\n";
for ($a = 0; $a < $amount_adj; $a++) {

    if ($faker->numberBetween(0, 100) > 40)
        $society = $save[$faker->numberBetween(0, count($save) - 1)] . " Debating Society;";
    else
        $society = $faker->city . " Debating Society;";

    $line = $society .
            addslashes($faker->firstName) . ";" .
            addslashes($faker->lastName) . ";" .
            $faker->email . ";" .
            $faker->numberBetween(0, 9) . "\n";
    //echo $line;
    $output_adjudicator .= $line;
}

$base = "../../../frontend/assets/csv/";
$handle_venue = fopen($base . "Sample_Venues.csv", "w");
$handle_teams = fopen($base . "Sample_Teams.csv", "w");
$handle_adj = fopen($base . "Sample_Adjudicators.csv", "w");

fwrite($handle_venue, $output_venue);
fclose($handle_venue);

fwrite($handle_teams, $output_teams);
fclose($handle_teams);

fwrite($handle_adj, $output_adjudicator);
fclose($handle_adj);

echo "\n";
